---
title: File Leases
description: "Acquire exclusive or shared locks for concurrent access control"
---

# File Leases

Leases provide advisory locking for concurrent file access. Use them when multiple clients may write to the same file.

## Lease Modes

| Mode          | Description                                   |
| ------------- | --------------------------------------------- |
| **Exclusive** | Single writer. Blocks all other leases.       |
| **Shared**    | Multiple readers. Blocked by exclusive lease. |

## Acquire a Lease

```typescript
const client = new RosetClient({
  baseUrl: "https://api.roset.dev",
  apiKey: "rsk_live_...",
});

// Acquire exclusive lease for 5 minutes
const lease = await client.leases.acquire(nodeId, {
  mode: "exclusive",
  durationSeconds: 300,
});

console.log(lease.expiresAt);
```

## Renew a Lease

Extend an existing lease before it expires:

```typescript
const renewed = await client.leases.renew(nodeId, {
  durationSeconds: 300,
});
```

## Release a Lease

Explicitly release when done:

```typescript
await client.leases.release(nodeId);
```

<Callout type="note">
  Leases auto-expire after their duration. Explicit release is optional but
  recommended.
</Callout>

## With Lease Helper

Execute a function while holding a lease, with automatic cleanup:

```typescript
const result = await client.leases.withLease(
  nodeId,
  { mode: "exclusive", durationSeconds: 60 },
  async (lease) => {
    // Do work while holding lease
    await processFile(nodeId);
    return "done";
  }
);
// Lease automatically released
```

## Check Existing Leases

List all leases on a file:

```typescript
const leases = await client.leases.getForNode(nodeId);
```

List all your active leases:

```typescript
const myLeases = await client.leases.getMine();
```

## Conflict Handling

If a lease conflicts, `acquire()` returns `null`:

```typescript
const lease = await client.leases.acquire(nodeId, { mode: "exclusive" });

if (!lease) {
  console.log("File is locked by another process");
}
```

## API Endpoints

| Method | Endpoint               | Description      |
| ------ | ---------------------- | ---------------- |
| POST   | `/v1/nodes/:id/lease`  | Acquire lease    |
| PATCH  | `/v1/nodes/:id/lease`  | Renew lease      |
| DELETE | `/v1/nodes/:id/lease`  | Release lease    |
| GET    | `/v1/nodes/:id/leases` | List node leases |
| GET    | `/v1/leases`           | List my leases   |
