# Nodes API

The Nodes API provides operations for managing files and folders in the Roset filesystem.

## Resolve Paths

<ApiEndpoint
  method="POST"
  path="/v1/resolve"
  description="Batch resolve paths to node IDs. Returns a map of paths to resolved nodes (or null if not found)."
>
  <ParameterTable
    type="body"
    params={[
      {
        name: "paths",
        type: "string[]",
        required: true,
        description: "Array of paths to resolve (max 100)",
      },
      {
        name: "baseId",
        type: "uuid",
        required: false,
        description:
          "Optional base folder ID to resolve relative paths against",
      },
    ]}
  />
  <RequestExample
    json={{
      paths: ["/documents/report.pdf", "/images/logo.png", "/nonexistent"],
    }}
  />
  <ResponseExample
    status={200}
    json={{
      "/documents/report.pdf": {
        id: "550e8400-e29b-41d4-a716-446655440000",
        name: "report.pdf",
        type: "file",
        parentId: "parent_uuid...",
        tenantId: "tenant_abc",
        mountId: "mount_123",
      },
      "/images/logo.png": {
        id: "550e8400-e29b-41d4-a716-446655440001",
        name: "logo.png",
        type: "file",
        parentId: "parent_uuid...",
        tenantId: "tenant_abc",
        mountId: "mount_123",
      },
      "/nonexistent": null,
    }}
  />
</ApiEndpoint>

## Get Node

<ApiEndpoint
  method="GET"
  path="/v1/nodes/:id"
  description="Retrieve metadata for a specific node."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "id",
        type: "string",
        required: true,
        description: "Node ID or 'root'",
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      id: "550e8400-e29b-41d4-a716-446655440000",
      tenantId: "tenant_abc",
      mountId: "mount_123",
      parentId: "550e8400-e29b-41d4-a716-446655440001",
      name: "report.pdf",
      type: "file",
      size: 1048576,
      contentType: "application/pdf",
      metadata: { author: "Jane Doe" },
      createdAt: "2025-01-15T10:30:00Z",
      updatedAt: "2025-01-15T10:30:00Z",
      version: {
        id: 42,
        nodeId: "550e8400-e29b-41d4-a716-446655440000",
        storageKey: "s3_key_...",
        size: 1048576,
        contentType: "application/pdf",
        isCurrent: true,
        createdAt: "2025-01-15T10:30:00Z",
      },
    }}
  />
</ApiEndpoint>

## List Children

<ApiEndpoint
  method="GET"
  path="/v1/nodes/:id/children"
  description="List child nodes of a folder with pagination."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "id",
        type: "string",
        required: true,
        description: "Parent folder ID or 'root'",
      },
    ]}
  />
  <ParameterTable
    type="query"
    params={[
      {
        name: "limit",
        type: "number",
        required: false,
        description: "Max results to return",
        default: "50",
      },
      {
        name: "cursor",
        type: "string",
        required: false,
        description: "Pagination cursor",
      },
      {
        name: "type",
        type: "string",
        required: false,
        description: 'Filter by type: "file" or "folder"',
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      items: [
        { id: "node1", name: "document.pdf", type: "file", size: 1024 },
        { id: "node2", name: "images", type: "folder", size: null },
      ],
      nextCursor: "eyJpZCI6Im5vZGUyIn0=",
      hasMore: true,
      total: 2,
      page: 1,
      pageSize: 50,
    }}
  />
</ApiEndpoint>

## Create Node

<ApiEndpoint
  method="POST"
  path="/v1/nodes"
  description="Create a new file or folder."
>
  <ParameterTable
    type="body"
    params={[
      {
        name: "name",
        type: "string",
        required: true,
        description: "Node name (max 255 chars)",
      },
      {
        name: "type",
        type: "string",
        required: true,
        description: '"file" or "folder"',
      },
      {
        name: "parentId",
        type: "uuid",
        required: false,
        description: "Parent folder ID (defaults to root)",
      },
      {
        name: "parentPath",
        type: "string",
        required: false,
        description: "Alternative: parent folder path",
      },
      {
        name: "metadata",
        type: "object",
        required: false,
        description: "Custom metadata key-value pairs",
      },
    ]}
  />
  <RequestExample
    json={{
      name: "quarterly-report.pdf",
      type: "file",
      parentId: "550e8400-e29b-41d4-a716-446655440001",
      metadata: { department: "finance" },
    }}
  />
  <ResponseExample
    status={201}
    json={{
      id: "550e8400-e29b-41d4-a716-446655440002",
      name: "quarterly-report.pdf",
      type: "file",
      parentId: "550e8400-e29b-41d4-a716-446655440001",
      metadata: { department: "finance" },
      createdAt: "2025-01-15T10:30:00Z",
    }}
  />
</ApiEndpoint>

## Copy Node

<ApiEndpoint
  method="POST"
  path="/v1/nodes/copy"
  description="Copy a node to a new location."
>
  <ParameterTable
    type="body"
    params={[
      {
        name: "nodeId",
        type: "uuid",
        required: true,
        description: "Source node ID",
      },
      {
        name: "destinationParentId",
        type: "uuid",
        required: true,
        description: "Destination folder ID",
      },
      {
        name: "newName",
        type: "string",
        required: false,
        description: "Optional new name for copy",
      },
    ]}
  />
  <RequestExample
    json={{
      nodeId: "src_123",
      destinationParentId: "dest_456",
      newName: "Copy of Report.pdf",
    }}
  />
  <ResponseExample
    status={201}
    json={{
      node: {
        id: "new_789",
        name: "Copy of Report.pdf",
        type: "file",
        parentId: "dest_456",
      },
      message: "Node copied successfully.",
    }}
  />
</ApiEndpoint>

## Update Node

<ApiEndpoint
  method="PATCH"
  path="/v1/nodes/:id"
  description="Rename or move a node. Moving a folder moves all descendants instantly."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "id",
        type: "string",
        required: true,
        description: "Node ID or 'root'",
      },
    ]}
  />
  <ParameterTable
    type="body"
    params={[
      {
        name: "name",
        type: "string",
        required: false,
        description: "New name",
      },
      {
        name: "parentId",
        type: "uuid",
        required: false,
        description: "New parent folder (move operation)",
      },
      {
        name: "metadata",
        type: "object",
        required: false,
        description: "Metadata to merge",
      },
    ]}
  />
  <RequestExample
    json={{
      name: "annual-report-2025.pdf",
      parentId: "550e8400-e29b-41d4-a716-446655440003",
    }}
  />
  <ResponseExample
    status={200}
    json={{
      id: "550e8400-e29b-41d4-a716-446655440002",
      name: "annual-report-2025.pdf",
      parentId: "550e8400-e29b-41d4-a716-446655440003",
      updatedAt: "2025-01-15T11:00:00Z",
    }}
  />
</ApiEndpoint>

## Get Manifest

<ApiEndpoint
  method="GET"
  path="/v1/nodes/:id/manifest"
  description="Get recursive manifest for committed folders (HPC/ML workloads)."
>
  <ParameterTable
    type="path"
    params={[
      { name: "id", type: "string", required: true, description: "Node ID" },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      "/": { type: "folder", id: "root_123" },
      "/data.csv": { type: "file", id: "file_456", size: 1024 },
    }}
  />
</ApiEndpoint>

## Commit Node

<ApiEndpoint
  method="POST"
  path="/v1/nodes/:id/commit"
  description="Initiate a commit (seal) for a folder version."
>
  <ParameterTable
    type="path"
    params={[
      { name: "id", type: "string", required: true, description: "Node ID" },
    ]}
  />
  <ParameterTable
    type="body"
    params={[
      {
        name: "message",
        type: "string",
        required: false,
        description: "Commit message",
      },
    ]}
  />
  <ResponseExample
    status={202}
    json={{
      commit: { id: "commit_abc" },
      _links: {
        self: "/v1/commits/commit_abc",
        poll: "/v1/commits/commit_abc",
      },
    }}
  />
</ApiEndpoint>

## Delete Node

<ApiEndpoint
  method="DELETE"
  path="/v1/nodes/:id"
  description="Soft delete a node. Deleted nodes can be restored within the retention period."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "id",
        type: "string",
        required: true,
        description: "Node ID or 'root'",
      },
    ]}
  />
  <ResponseExample status={204} description="No content" json={{}} />
</ApiEndpoint>

## Restore Node

<ApiEndpoint
  method="POST"
  path="/v1/nodes/:id/restore"
  description="Restore a soft-deleted node from trash."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "id",
        type: "string",
        required: true,
        description: "Deleted node ID",
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      id: "550e8400-e29b-41d4-a716-446655440002",
      name: "annual-report-2025.pdf",
      deletedAt: null,
      updatedAt: "2025-01-15T12:00:00Z",
    }}
  />
</ApiEndpoint>

## Batch Operations

### Batch Stat

<ApiEndpoint
  method="POST"
  path="/v1/nodes/batch/stat"
  description="Get metadata for multiple nodes by ID in a single request. Returns a map."
>
  <ParameterTable
    type="body"
    params={[
      {
        name: "ids",
        type: "uuid[]",
        required: true,
        description: "Array of node IDs (max 100)",
      },
    ]}
  />
  <RequestExample
    json={{
      ids: [
        "550e8400-e29b-41d4-a716-446655440000",
        "550e8400-e29b-41d4-a716-446655440001",
      ],
    }}
  />
  <ResponseExample
    status={200}
    json={{
      "550e8400-e29b-41d4-a716-446655440000": {
        id: "550e8400-e29b-41d4-a716-446655440000",
        name: "report.pdf",
        type: "file",
      },
      "550e8400-e29b-41d4-a716-446655440001": null,
    }}
  />
</ApiEndpoint>

### Batch Delete

<ApiEndpoint
  method="POST"
  path="/v1/nodes/batch/delete"
  description="Soft delete multiple nodes atomically. All nodes are moved to trash."
>
  <ParameterTable
    type="body"
    params={[
      {
        name: "ids",
        type: "uuid[]",
        required: true,
        description: "Array of node IDs to delete (max 100)",
      },
    ]}
  />
  <RequestExample
    json={{
      ids: ["id1", "id2", "id3"],
    }}
  />
  <ResponseExample status={204} description="No content" json={{}} />
</ApiEndpoint>

### Batch Move

<ApiEndpoint
  method="POST"
  path="/v1/nodes/batch/move"
  description="Move multiple nodes to a new parent folder atomically."
>
  <ParameterTable
    type="body"
    params={[
      {
        name: "ids",
        type: "uuid[]",
        required: true,
        description: "Array of node IDs to move (max 100)",
      },
      {
        name: "parentId",
        type: "uuid",
        required: true,
        description: "Destination parent folder ID",
      },
    ]}
  />
  <RequestExample
    json={{
      ids: ["id1", "id2"],
      parentId: "folder-id",
    }}
  />
  <ResponseExample
    status={200}
    json={[
      { id: "id1", name: "file1.pdf", parentId: "folder-id" },
      { id: "id2", name: "file2.pdf", parentId: "folder-id" },
    ]}
  />
</ApiEndpoint>

## Trash Management

### List Trash

<ApiEndpoint
  method="GET"
  path="/v1/trash"
  description="List items in trash with pagination."
>
  <ParameterTable
    type="query"
    params={[
      {
        name: "pageSize",
        type: "number",
        required: false,
        description: "Items per page",
        default: "50",
      },
      {
        name: "cursor",
        type: "string",
        required: false,
        description: "Pagination cursor",
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      items: [
        {
          id: "node1",
          name: "deleted-file.pdf",
          deletedAt: "2025-01-15T10:00:00Z",
        },
      ],
      total: 1,
      hasMore: false,
    }}
  />
</ApiEndpoint>

### Empty Trash

<ApiEndpoint
  method="DELETE"
  path="/v1/trash"
  description="Permanently delete all items in trash."
>
  <ResponseExample
    status={200}
    json={{
      deletedCount: 42,
    }}
  />
</ApiEndpoint>

### Permanent Delete

<ApiEndpoint
  method="DELETE"
  path="/v1/nodes/:id/permanent"
  description="Permanently delete a single node from trash."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "id",
        type: "string",
        required: true,
        description: "Trashed node ID",
      },
    ]}
  />
  <ResponseExample status={204} description="No content" json={{}} />
</ApiEndpoint>

### Batch Permanent Delete

<ApiEndpoint
  method="POST"
  path="/v1/nodes/batch/permanent-delete"
  description="Permanently delete multiple nodes from trash atomically."
>
  <ParameterTable
    type="body"
    params={[
      {
        name: "ids",
        type: "uuid[]",
        required: true,
        description: "Array of trashed node IDs (max 100)",
      },
    ]}
  />
  <RequestExample
    json={{
      ids: ["id1", "id2"],
    }}
  />
  <ResponseExample status={204} description="No content" json={{}} />
</ApiEndpoint>
