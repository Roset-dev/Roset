# Audit API

The Audit API provides access to the append-only operation log. Every action in Roset is recorded for compliance, debugging, and undo capabilities.

<Callout type="info" title="Retention">
  Audit logs are retained according to your plan. Enterprise plans support
  configurable retention and SIEM integration.
</Callout>

## Query Audit Log

<ApiEndpoint
  method="GET"
  path="/v1/audit"
  description="Query the audit log with filters."
>
  <ParameterTable
    type="query"
    params={[
      {
        name: "action",
        type: "string",
        required: false,
        description: 'Filter by action type (e.g., "node.create")',
      },
      {
        name: "actorId",
        type: "uuid",
        required: false,
        description: "Filter by actor (user/key ID)",
      },
      {
        name: "nodeId",
        type: "string",
        required: false,
        description: 'Filter by target node ID (or "root")',
      },
      {
        name: "startDate",
        type: "string",
        required: false,
        description: "ISO timestamp (inclusive)",
      },
      {
        name: "endDate",
        type: "string",
        required: false,
        description: "ISO timestamp (exclusive)",
      },
      {
        name: "pageSize",
        type: "number",
        required: false,
        description: "Max results",
        default: "50",
      },
      {
        name: "page",
        type: "number",
        required: false,
        description: "Page number",
        default: "1",
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      items: [
        {
          id: "op_abc123",
          tenantId: "tenant_789",
          action: "node.create",
          actorType: "user",
          actorId: "user_123",
          targetType: "node",
          targetId: "550e8400-e29b-41d4-a716-446655440000",
          payload: {
            name: "report.pdf",
            type: "file",
            parentId: "550e8400-e29b-41d4-a716-446655440001",
          },
          createdAt: "2025-01-15T10:30:00Z",
        },
      ],
      total: 1540,
      page: 1,
      pageSize: 50,
      hasMore: true,
    }}
  />
</ApiEndpoint>

## Export Audit Log

<ApiEndpoint
  method="GET"
  path="/v1/audit/export"
  description="Export audit logs in bulk for compliance or backup. Returns a signed URL to download."
>
  <ParameterTable
    type="query"
    params={[
      {
        name: "startDate",
        type: "string",
        required: true,
        description: "Export start (ISO timestamp)",
      },
      {
        name: "endDate",
        type: "string",
        required: true,
        description: "Export end (ISO timestamp)",
      },
      {
        name: "format",
        type: "string",
        required: false,
        description: '"json" or "csv"',
        default: '"json"',
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      downloadUrl: "https://storage.example.com/exports/audit-2025-01.json?...",
      expiresAt: "2025-01-15T11:30:00Z",
    }}
  />
</ApiEndpoint>

## Get Node Audit History

<ApiEndpoint
  method="GET"
  path="/v1/nodes/:id/audit"
  description="Get the complete history of operations on a specific node."
>
  <ParameterTable
    type="path"
    params={[
      { name: "id", type: "uuid", required: true, description: "Node ID" },
    ]}
  />
  <ParameterTable
    type="query"
    params={[
      {
        name: "pageSize",
        type: "number",
        required: false,
        description: "Max results",
        default: "50",
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      items: [
        {
          id: "op_xyz789",
          action: "node.update",
          actorId: "user_456",
          payload: {
            changes: { name: { from: "old.pdf", to: "new.pdf" } },
          },
          createdAt: "2025-01-15T11:00:00Z",
        },
      ],
      total: 5,
      page: 1,
      pageSize: 50,
      hasMore: false,
    }}
  />
</ApiEndpoint>

## Action Types

| Action          | Description                              |
| --------------- | ---------------------------------------- |
| `node.create`   | File or folder created                   |
| `node.update`   | Node renamed, moved, or metadata updated |
| `node.delete`   | Node soft deleted                        |
| `node.restore`  | Node restored from trash                 |
| `node.purge`    | Node permanently deleted                 |
| `upload.init`   | Upload initialized                       |
| `upload.commit` | Upload finalized                         |
| `share.create`  | Share link created                       |
| `share.revoke`  | Share link revoked                       |
| `lease.acquire` | Lease acquired                           |
| `lease.release` | Lease released                           |
| `acl.grant`     | Permission granted                       |
| `acl.revoke`    | Permission revoked                       |
| `mount.create`  | Mount created                            |
| `mount.update`  | Mount updated                            |
| `mount.delete`  | Mount deleted                            |
