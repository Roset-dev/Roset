# Integrations API

Manage cloud provider connections and imported buckets. Roset supports both OAuth-based connections and manual credential configuration.

## List Integrations

<ApiEndpoint
  method="GET"
  path="/v1/integrations"
  description="List all configured cloud provider integrations."
>
  <ResponseExample
    status={200}
    json={{
      items: [
        {
          id: "int_123",
          provider: "aws",
          status: "connected",
          bucketCount: 5,
          createdAt: "2025-01-01T00:00:00Z",
          updatedAt: "2025-01-01T00:00:00Z",
        },
      ],
      providers: ["aws", "gcp", "azure", "supabase", "cloudflare", "minio"],
    }}
  />
</ApiEndpoint>

## Start Integration (OAuth)

<ApiEndpoint
  method="POST"
  path="/v1/integrations/:provider/start"
  description="Start the OAuth flow to connect a cloud provider."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "provider",
        type: "string",
        required: true,
        description: "Provider: aws, gcp, azure, supabase, cloudflare, minio",
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      integration_id: "int_456",
      auth_url: "https://accounts.google.com/o/oauth2/...",
    }}
  />
</ApiEndpoint>

## Verify Cloudflare R2 Token

<ApiEndpoint
  method="POST"
  path="/v1/integrations/r2/verify-token"
  description="Manually connect Cloudflare R2 using an API Token."
>
  <ParameterTable
    type="body"
    params={[
      {
        name: "integration_id",
        type: "uuid",
        required: true,
        description: "Integration ID (from start)",
      },
      {
        name: "account_id",
        type: "string",
        required: true,
        description: "Cloudflare Account ID",
      },
      {
        name: "api_token",
        type: "string",
        required: true,
        description: "R2 API Token",
      },
      {
        name: "parent_access_key_id",
        type: "string",
        required: false,
        description: "For vendoring temp credentials",
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{ success: true, integration_id: "int_123" }}
  />
</ApiEndpoint>

## Verify MinIO Credentials

<ApiEndpoint
  method="POST"
  path="/v1/integrations/minio/verify-key"
  description="Manually connect a MinIO instance."
>
  <ParameterTable
    type="body"
    params={[
      { name: "integration_id", type: "uuid", required: true },
      {
        name: "endpoint_url",
        type: "string",
        required: true,
        description: "MinIO Server URL",
      },
      {
        name: "bucket",
        type: "string",
        required: true,
        description: "Bucket to verify access",
      },
      { name: "access_key_id", type: "string", required: true },
      { name: "secret_access_key", type: "string", required: true },
      { name: "region", type: "string", required: false, default: "us-east-1" },
    ]}
  />
  <ResponseExample
    status={200}
    json={{ success: true, integration_id: "int_123" }}
  />
</ApiEndpoint>

## Verify AWS Role

<ApiEndpoint
  method="POST"
  path="/v1/integrations/aws/verify-role"
  description="Connect AWS using a Role ARN."
>
  <ParameterTable
    type="body"
    params={[
      { name: "integration_id", type: "uuid", required: true },
      {
        name: "role_arn",
        type: "string",
        required: true,
        description: "IAM Role ARN",
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{ success: true, integration_id: "int_123" }}
  />
</ApiEndpoint>

## Verify GCP Service Account

<ApiEndpoint
  method="POST"
  path="/v1/integrations/gcp/verify-key"
  description="Connect GCP using a Service Account JSON Key."
>
  <ParameterTable
    type="body"
    params={[
      { name: "integration_id", type: "uuid", required: true },
      {
        name: "json_key",
        type: "string",
        required: true,
        description: "JSON Key string",
      },
      {
        name: "bucket_name",
        type: "string",
        required: false,
        description: "Optional bucket to test",
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{ success: true, integration_id: "int_123" }}
  />
</ApiEndpoint>

## Verify Azure Service Principal

<ApiEndpoint
  method="POST"
  path="/v1/integrations/azure/verify"
  description="Connect Azure using Service Principal credentials."
>
  <ParameterTable
    type="body"
    params={[
      { name: "integration_id", type: "uuid", required: true },
      { name: "tenant_id", type: "string", required: true },
      { name: "subscription_ids", type: "array", required: false },
    ]}
  />
  <ResponseExample
    status={200}
    json={{ success: true, integration_id: "int_123" }}
  />
</ApiEndpoint>

## Sync Integration

<ApiEndpoint
  method="POST"
  path="/v1/integrations/:id/sync"
  description="Trigger discovery of accounts and buckets from the provider."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "id",
        type: "uuid",
        required: true,
        description: "Integration ID",
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      accounts_synced: 1,
      buckets_synced: 15,
    }}
  />
</ApiEndpoint>

## List Buckets

<ApiEndpoint
  method="GET"
  path="/v1/integrations/:id/buckets"
  description="List all discovered buckets for an integration."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "id",
        type: "uuid",
        required: true,
        description: "Integration ID",
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      accounts: [
        {
          id: "acc_789",
          externalId: "123456789",
          name: "Production Account",
          buckets: [
            {
              id: "bkt_101",
              bucketName: "prod-data",
              region: "us-east-1",
              isImported: false,
              importedMountId: null,
            },
          ],
        },
      ],
    }}
  />
</ApiEndpoint>

## Import Bucket

<ApiEndpoint
  method="POST"
  path="/v1/integrations/:id/buckets/:bucketId/import"
  description="Import a discovered bucket as a Roset Mount."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "id",
        type: "uuid",
        required: true,
        description: "Integration ID",
      },
      {
        name: "bucketId",
        type: "uuid",
        required: true,
        description: "Bucket ID",
      },
    ]}
  />
  <ParameterTable
    type="body"
    params={[
      {
        name: "name",
        type: "string",
        required: true,
        description: "Name for the new Mount",
      },
      {
        name: "retentionDays",
        type: "number",
        required: false,
        description: "Default trash retention",
        default: "30",
      },
      {
        name: "isDefault",
        type: "boolean",
        required: false,
        description: "Set as default mount",
        default: "false",
      },
      {
        name: "basePrefix",
        type: "string",
        required: false,
        description: "Mount only this prefix",
        default: "",
      },
    ]}
  />
  <ResponseExample
    status={201}
    json={{
      id: "mount_abc",
      name: "Production Data",
      provider: "s3",
      bucket: "prod-data",
      region: "us-east-1",
      createdAt: "2025-01-01T00:00:00Z",
    }}
  />
</ApiEndpoint>

## Delete Integration

<ApiEndpoint
  method="DELETE"
  path="/v1/integrations/:id"
  description="Revoke connection and delete integration configuration."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "id",
        type: "uuid",
        required: true,
        description: "Integration ID",
      },
    ]}
  />
  <ResponseExample status={204} description="No content" json={{}} />
</ApiEndpoint>
