# Integrations API

Manage cloud provider connections and imported buckets. Roset supports both OAuth-based connections and manual credential configuration.

## List Integrations

<ApiEndpoint
  method="GET"
  path="/v1/integrations"
  description="List all configured cloud provider integrations."
>
  <ResponseExample
    status={200}
    json={{
      items: [
        {
          id: "int_123",
          provider: "aws",
          connectMethod: "install",
          status: "connected",
          bucketCount: 5,
          createdAt: "2025-01-01T00:00:00Z",
          updatedAt: "2025-01-01T00:00:00Z",
        },
      ],
      providers: ["aws", "gcp", "azure", "supabase", "cloudflare", "minio"],
    }}
  />
</ApiEndpoint>

## Start Integration (OAuth)

<ApiEndpoint
  method="POST"
  path="/v1/integrations/:provider/start"
  description="Start the OAuth flow to connect a cloud provider."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "provider",
        type: "string",
        required: true,
        description: "Provider: aws, gcp, azure, supabase, cloudflare, minio",
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      integration_id: "int_456",
      auth_url: "https://accounts.google.com/o/oauth2/...",
    }}
  />
</ApiEndpoint>

## Verify Integration

<ApiEndpoint
  method="POST"
  path="/v1/integrations/:id/verify"
  description="Verify updated credentials or configuration for an integration. Used for Manual and Install flows."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "id",
        type: "uuid",
        required: true,
        description: "Integration ID",
      },
    ]}
  />
  <ParameterTable
    type="body"
    params={[
      {
        name: "...",
        type: "object",
        required: true,
        description:
          "Provider-specific credential fields (e.g. role_arn for AWS, json_key for GCP, api_token for Cloudflare)",
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{ success: true, integration_id: "int_123" }}
  />
</ApiEndpoint>

## Sync Integration

<ApiEndpoint
  method="POST"
  path="/v1/integrations/:id/sync"
  description="Trigger discovery of accounts and buckets from the provider."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "id",
        type: "uuid",
        required: true,
        description: "Integration ID",
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      accounts_synced: 1,
      buckets_synced: 15,
    }}
  />
</ApiEndpoint>

## List Buckets

<ApiEndpoint
  method="GET"
  path="/v1/integrations/:id/buckets"
  description="List all discovered buckets for an integration."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "id",
        type: "uuid",
        required: true,
        description: "Integration ID",
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      accounts: [
        {
          id: "acc_789",
          externalId: "123456789",
          name: "Production Account",
          buckets: [
            {
              id: "bkt_101",
              bucketName: "prod-data",
              region: "us-east-1",
              isImported: false,
              importedMountId: null,
            },
          ],
        },
      ],
    }}
  />
</ApiEndpoint>

## Import Bucket

<ApiEndpoint
  method="POST"
  path="/v1/integrations/:id/buckets/:bucketId/import"
  description="Import a discovered bucket as a Roset Mount."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "id",
        type: "uuid",
        required: true,
        description: "Integration ID",
      },
      {
        name: "bucketId",
        type: "uuid",
        required: true,
        description: "Bucket ID",
      },
    ]}
  />
  <ParameterTable
    type="body"
    params={[
      {
        name: "name",
        type: "string",
        required: true,
        description: "Name for the new Mount",
      },
      {
        name: "retentionDays",
        type: "number",
        required: false,
        description: "Default trash retention",
        default: "30",
      },
      {
        name: "isDefault",
        type: "boolean",
        required: false,
        description: "Set as default mount",
        default: "false",
      },
      {
        name: "basePrefix",
        type: "string",
        required: false,
        description: "Mount only this prefix",
        default: "",
      },
    ]}
  />
  <ResponseExample
    status={201}
    json={{
      id: "mount_abc",
      name: "Production Data",
      provider: "s3",
      bucket: "prod-data",
      region: "us-east-1",
      createdAt: "2025-01-01T00:00:00Z",
    }}
  />
</ApiEndpoint>

## Delete Integration

<ApiEndpoint
  method="DELETE"
  path="/v1/integrations/:id"
  description="Revoke connection and delete integration configuration."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "id",
        type: "uuid",
        required: true,
        description: "Integration ID",
      },
    ]}
  />
  <ResponseExample status={204} description="No content" json={{}} />
</ApiEndpoint>
