# ML & Checkpoints API

Atomic checkpoint management for Machine Learning workloads. This API enables versioning of large datasets (folders) with Git-like semantics.

## List Commits

<ApiEndpoint
  method="GET"
  path="/v1/commits"
  description="List commit history for a tenant."
>
  <ParameterTable
    type="query"
    params={[
      {
        name: "nodeId",
        type: "uuid",
        required: false,
        description: "Filter by node ID",
      },
      {
        name: "groupId",
        type: "uuid",
        required: false,
        description: "Filter by commit group ID",
      },
      {
        name: "status",
        type: "string",
        required: false,
        description: "'pending', 'completed', or 'failed'",
      },
      { name: "limit", type: "number", required: false, default: "50" },
      { name: "cursor", type: "string", required: false },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      items: [
        {
          id: "commit_123",
          nodeId: "node_456",
          status: "completed",
          message: "Step 1000",
          stats: { added: 5, deleted: 0 },
          createdAt: "2025-01-01T10:00:00Z",
          actorId: "user_123",
        },
      ],
      total: 100,
      page: 1,
      pageSize: 50,
    }}
  />
</ApiEndpoint>

## Get Commit

<ApiEndpoint
  method="GET"
  path="/v1/commits/:id"
  description="Get detailed status of a commit."
>
  <ParameterTable
    type="path"
    params={[
      { name: "id", type: "uuid", required: true, description: "Commit ID" },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      commit: {
        id: "commit_123",
        nodeId: "node_456",
        status: "completed",
        message: "Step 1000",
        stats: { added: 5, deleted: 0 },
        createdAt: "2025-01-01T10:00:00Z",
      },
    }}
  />
</ApiEndpoint>

## Compare Commits (Diff)

<ApiEndpoint
  method="GET"
  path="/v1/commits/:id/compare"
  description="Compute metadata diff between two checkpoints."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "id",
        type: "uuid",
        required: true,
        description: "Target Commit ID",
      },
    ]}
  />
  <ParameterTable
    type="query"
    params={[
      {
        name: "base_id",
        type: "uuid",
        required: true,
        description: "Base Commit ID",
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      summary: {
        added: 5,
        removed: 0,
        changed: 2,
        sizeDelta: 1024,
        sizeDeltaPercent: 0.1,
      },
      files: [
        {
          path: "/data/train.csv",
          status: "modified",
          sizeA: 1000,
          sizeB: 1200,
        },
      ],
    }}
  />
</ApiEndpoint>

## List Refs

<ApiEndpoint
  method="GET"
  path="/v1/refs"
  description="List all release pointers (e.g. 'latest', 'production')."
>
  <ResponseExample
    status={200}
    json={{
      refs: [
        {
          name: "latest",
          commitId: "commit_123",
          updatedAt: "2025-01-01T10:00:00Z",
          tenantId: "tenant_123",
          mountId: "mount_456",
        },
      ],
    }}
  />
</ApiEndpoint>

## Get Latest Ref

<ApiEndpoint
  method="GET"
  path="/v1/refs/latest"
  description="Get the most recently updated ref for the active mount."
>
  <ResponseExample
    status={200}
    json={{
      ref: {
        name: "latest",
        commitId: "commit_123",
        updatedAt: "2025-01-01T10:00:00Z",
      },
      commit: {
        id: "commit_123",
        message: "Step 1000",
        status: "completed",
        createdAt: "2025-01-01T10:00:00Z",
      },
    }}
  />
</ApiEndpoint>

## Get Ref

<ApiEndpoint
  method="GET"
  path="/v1/refs/:name"
  description="Get details of a specific named ref."
>
  <ParameterTable
    type="path"
    params={[
      { name: "name", type: "string", required: true, description: "Ref name" },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      ref: {
        name: "production",
        commitId: "commit_456",
        updatedAt: "2025-01-02T10:00:00Z",
      },
      commit: {
        id: "commit_456",
        message: "Release v1.0",
        status: "completed",
        createdAt: "2025-01-02T09:55:00Z",
      },
    }}
  />
</ApiEndpoint>

## Update Ref (CAS)

<ApiEndpoint
  method="PUT"
  path="/v1/refs/:name"
  description="Create or update a named reference pointer. Supports Compare-and-Swap."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "name",
        type: "string",
        required: true,
        description: "Ref name (e.g. 'latest')",
      },
    ]}
  />
  <ParameterTable
    type="body"
    params={[
      {
        name: "commit_id",
        type: "uuid",
        required: true,
        description: "Commit ID to point to",
      },
      {
        name: "expected_commit_id",
        type: "uuid",
        required: false,
        description: "Previous commit ID (for CAS safety)",
      },
    ]}
  />
  <RequestExample
    json={{
      commit_id: "commit_999",
      expected_commit_id: "commit_888",
    }}
  />
  <ResponseExample
    status={200}
    json={{
      ref: {
        name: "latest",
        commitId: "commit_999",
        updatedAt: "2025-01-03T12:00:00Z",
      },
      message: "Ref updated successfully",
    }}
  />
</ApiEndpoint>

## Create Commit Group

<ApiEndpoint
  method="POST"
  path="/v1/commit-groups"
  description="Create a group for atomic multi-folder commits."
>
  <ParameterTable
    type="body"
    params={[
      {
        name: "message",
        type: "string",
        required: false,
        description: "Group description",
      },
    ]}
  />
  <ResponseExample
    status={201}
    json={{
      group: {
        id: "grp_123",
        status: "pending",
        message: "Batch Update",
        createdAt: "2025-01-01T10:00:00Z",
      },
    }}
  />
</ApiEndpoint>

## Get Commit Group

<ApiEndpoint
  method="GET"
  path="/v1/commit-groups/:id"
  description="Get group status and member commits."
>
  <ParameterTable
    type="path"
    params={[
      { name: "id", type: "uuid", required: true, description: "Group ID" },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      group: {
        id: "grp_123",
        status: "pending",
        message: "Batch Update",
        createdAt: "2025-01-01T10:00:00Z",
      },
      commits: [{ id: "commit_1", status: "completed" }],
    }}
  />
</ApiEndpoint>

## Seal Commit Group

<ApiEndpoint
  method="POST"
  path="/v1/commit-groups/:id/seal"
  description="Atomically finalize all commits in the group."
>
  <ParameterTable
    type="path"
    params={[
      { name: "id", type: "uuid", required: true, description: "Group ID" },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      group: {
        id: "grp_123",
        status: "committed",
        committedAt: "2025-01-01T10:05:00Z",
      },
      message: "Commit group sealed successfully",
    }}
  />
</ApiEndpoint>
