# Shares API

The Shares API enables creating and managing shareable links for files and folders. Share links provide controlled access without requiring authentication.

## Create Share

<ApiEndpoint
  method="POST"
  path="/v1/shares"
  description="Create a new share link for a node."
>
  <ParameterTable
    type="body"
    params={[
      {
        name: "nodeId",
        type: "uuid",
        required: true,
        description: "Node to share",
      },
      {
        name: "scope",
        type: "string",
        required: false,
        description: '"read" or "write"',
        default: '"read"',
      },
      {
        name: "expiresIn",
        type: "string",
        required: false,
        description: 'Expiry duration (e.g., "7d", "24h")',
      },
      {
        name: "expiresAt",
        type: "string",
        required: false,
        description: "Specific expiry timestamp (ISO 8601)",
      },
      {
        name: "password",
        type: "string",
        required: false,
        description: "Optional password protection (min 4 chars)",
      },
      {
        name: "maxDownloads",
        type: "number",
        required: false,
        description: "Maximum download count",
      },
      {
        name: "recipient",
        type: "string",
        required: false,
        description: "Optional email recipient metadata",
      },
    ]}
  />
  <RequestExample
    json={{
      nodeId: "550e8400-e29b-41d4-a716-446655440000",
      scope: "read",
      expiresIn: "7d",
      maxDownloads: 100,
    }}
  />
  <ResponseExample
    status={201}
    json={{
      id: "share_abc123",
      token: "shr_Kj8nM2pL4qR7...",
      url: "https://share.roset.dev/v1/s/shr_Kj8nM2pL4qR7...",
      tenantId: "tenant_123",
      nodeId: "550e8400-e29b-41d4-a716-446655440000",
      scope: "read",
      maxDownloads: 100,
      downloadCount: 0,
      expiresAt: "2025-01-22T10:30:00Z",
      revokedAt: null,
      hasPassword: false,
      createdBy: "user_123",
      createdAt: "2025-01-15T10:30:00Z",
    }}
  />
</ApiEndpoint>

## List Shares

<ApiEndpoint
  method="GET"
  path="/v1/shares"
  description="List all shares for the tenant."
>
  <ParameterTable
    type="query"
    params={[
      {
        name: "includeRevoked",
        type: "boolean",
        required: false,
        description: "Include revoked shares",
        default: "false",
      },
      {
        name: "includeExpired",
        type: "boolean",
        required: false,
        description: "Include expired shares",
        default: "false",
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      shares: [
        {
          id: "share_abc123",
          token: "shr_Kj8nM2pL4qR7...",
          url: "https://share.roset.dev/v1/s/shr_Kj8nM2pL4qR7...",
          nodeId: "550e8400-e29b-41d4-a716-446655440000",
          scope: "read",
          expiresAt: "2025-01-22T10:30:00Z",
          downloadCount: 5,
        },
      ],
    }}
  />
</ApiEndpoint>

## List Node Shares

<ApiEndpoint
  method="GET"
  path="/v1/nodes/:id/shares"
  description="List all active shares for a specific node."
>
  <ParameterTable
    type="path"
    params={[
      { name: "id", type: "uuid", required: true, description: "Node ID" },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      items: [
        {
          id: "share_abc123",
          token: "shr_Kj8nM2pL4qR7...",
          url: "https://share.roset.dev/v1/s/shr_Kj8nM2pL4qR7...",
          nodeId: "550e8400-e29b-41d4-a716-446655440000",
          scope: "read",
        },
      ],
    }}
  />
</ApiEndpoint>

## Get Share

<ApiEndpoint
  method="GET"
  path="/v1/shares/:token"
  description="Get detailed information about a share (authenticated)."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "token",
        type: "string",
        required: true,
        description: "Share token",
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      id: "share_abc123",
      token: "shr_Kj8nM2pL4qR7...",
      url: "https://share.roset.dev/v1/s/shr_Kj8nM2pL4qR7...",
      nodeId: "550e8400-e29b-41d4-a716-446655440000",
      scope: "read",
      hasPassword: true,
      downloadCount: 42,
    }}
  />
</ApiEndpoint>

## Update Share

<ApiEndpoint
  method="PATCH"
  path="/v1/shares/:id"
  description="Update share details (e.g. extend expiry)."
>
  <ParameterTable
    type="path"
    params={[
      { name: "id", type: "uuid", required: true, description: "Share ID" },
    ]}
  />
  <ParameterTable
    type="body"
    params={[
      {
        name: "expiresIn",
        type: "string",
        required: false,
        description: "Add time (e.g. '3d')",
      },
      {
        name: "expiresAt",
        type: "string",
        required: false,
        description: "Set new expiry (ISO 8601)",
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      id: "share_abc123",
      expiresAt: "2025-02-01T10:00:00Z",
    }}
  />
</ApiEndpoint>

## Revoke Share

<ApiEndpoint
  method="DELETE"
  path="/v1/shares/:token"
  description="Revoke a share link. The link will no longer be accessible."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "token",
        type: "string",
        required: true,
        description: "Share token",
      },
    ]}
  />
  <ResponseExample status={204} description="No content" json={{}} />
</ApiEndpoint>

## Access Shared Content

<ApiEndpoint
  method="GET"
  path="/v1/s/:token"
  auth="optional"
  description="Access content via share link (public/password protected)."
>
  <ParameterTable
    type="path"
    params={[
      {
        name: "token",
        type: "string",
        required: true,
        description: "Share token",
      },
    ]}
  />
  <ParameterTable
    type="query"
    params={[
      {
        name: "password",
        type: "string",
        required: false,
        description: "Password if protected",
      },
      {
        name: "download",
        type: "boolean",
        required: false,
        description: "Download file directly (redirect)",
      },
    ]}
  />
  <ResponseExample
    status={200}
    json={{
      node: {
        id: "550e8400-e29b-41d4-a716-446655440000",
        name: "report.pdf",
        type: "file",
        size: 1048576,
        contentType: "application/pdf",
      },
      scope: "read",
      expiresAt: "2025-01-22T10:30:00Z",
    }}
  />
  <ResponseExample
    status={302}
    description="Redirect to download URL (if download=true)"
  />
  <ResponseExample
    status={401}
    json={{
      error: "Password required",
      code: "PASSWORD_REQUIRED",
      requiresPassword: true,
    }}
  />
</ApiEndpoint>
